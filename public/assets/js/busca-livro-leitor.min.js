document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("search-input");var t=document.getElementById("search-button");let a=document.getElementById("search-results"),i=document.querySelector(".search-container");async function n(e){if(e.length<2)a.innerHTML="",a.classList.remove("active");else try{var t=await fetch("/biblioteca/leitor/busca?q="+encodeURIComponent(e),{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('input[name="_csrf_token"]')?.value}});if(!t.ok)throw new Error("Erro na busca");var n=await t.json();if(a.innerHTML="",n.livros.length||n.bibliotecas.length){if(n.bibliotecas.length){let i=document.createElement("div");i.innerHTML="<h4>Bibliotecas</h4>",n.bibliotecas.forEach(e=>{var t=document.createElement("div");t.classList.add("result-item"),t.innerHTML=`
                    <h4>${e.nome}</h4>
                    <p>${e.descricao?e.descricao.slice(0,100)+"...":"Sem descrição"}</p>
                    <a href="/biblioteca/${e.id}">Ver Biblioteca</a>
                `,i.appendChild(t)}),a.appendChild(i)}if(n.livros.length){let i=document.createElement("div");i.innerHTML="<h4>Livros</h4>",n.livros.forEach(e=>{var t=document.createElement("div");t.classList.add("result-item"),t.innerHTML=`
                    <h4>${e.titulo}</h4>
                    <p>Autor: ${e.autor||"Desconhecido"} | Biblioteca: ${e.biblioteca_nome||"Sem biblioteca"}</p>
                    <a href="/livro/${e.id}">Ver Livro</a>
                `,i.appendChild(t)}),a.appendChild(i)}}else a.innerHTML='<div class="result-item"><p>Nenhum resultado encontrado.</p></div>';a.classList.add("active")}catch(e){console.error("Erro ao realizar busca:",e),a.innerHTML='<div class="result-item"><p>Erro ao realizar a busca. Tente novamente.</p></div>',a.classList.add("active")}}let r;e.addEventListener("input",function(){clearTimeout(r),r=setTimeout(()=>{n(this.value.trim())},300)}),t.addEventListener("click",function(){n(e.value.trim())}),document.addEventListener("click",function(e){i.contains(e.target)||(a.innerHTML="",a.classList.remove("active"))})});